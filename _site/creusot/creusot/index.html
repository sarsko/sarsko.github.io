<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Some tips on doing program proofs in Creusot -</title>
<meta name="description" content="– This is a Work In Progress! Going to add more stuff soon™ –">


  <meta name="author" content="Sarek Skotåm">
  
  <meta property="article:author" content="Sarek Skotåm">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="">
<meta property="og:title" content="Some tips on doing program proofs in Creusot">
<meta property="og:url" content="http://localhost:4000/creusot/creusot/">


  <meta property="og:description" content="– This is a Work In Progress! Going to add more stuff soon™ –">







  <meta property="article:published_time" content="2022-06-13T21:34:30+02:00">






<link rel="canonical" href="http://localhost:4000/creusot/creusot/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/creusot/">Creusot</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/assets/images/bio-photo.jpg" alt="Sarek Skotåm" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Sarek Skotåm</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Norwegian programmer. Into Rust and formal methods. Author of <a href="https://github.com/sarsko/CreuSAT">CreuSAT</a>.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://github.com/sarsko/CreuSAT" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">CreuSAT</span></a></li>
          
        
          
            <li><a href="https://github.com/sarsko" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="mailto:sarek.skotam@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Mail me</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Some tips on doing program proofs in Creusot">
    <meta itemprop="description" content="– This is a Work In Progress! Going to add more stuff soon™ –">
    <meta itemprop="datePublished" content="2022-06-13T21:34:30+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/creusot/creusot/" class="u-url" itemprop="url">Some tips on doing program proofs in Creusot
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <p>– This is a Work In Progress! Going to add more stuff soon™ –</p>

<p>The following is a sort of guide to Creusot, based on my experience in using it
to verify SAT solvers as a part of my masters. It is based on the observation
that it would be very nice if there were more resources for learning deductive
verification. There may be a case for making a general guide for learning
deductive verification: that is for another day and most likely someone else —
this is a guide for learning Creusot. This is my attempt at distilling some of
my learnings into something which I hope is helpful for those attempting to learn
either deductive verification, or Creusot in particular.</p>

<p>I don’t claim to be some higher being of divine verification prowess, and this
work is neither complete, nor (I would assume) perfect. If you have additions
you would like to suggest, or corrections to what is in here, please file a pull
request, or message/mail me. I believe my relative “youth” in proving programs
is to some degree a strength — hopefully I remember more of the pain-points (that
being said, if you are some higher being of divine verification prowess, please
a guide, I would love to read it).</p>

<p>It is in a very limited way complementary (speaking of compliments, you are looking
particularly nice today) to my thesis — some examples will be from it
it, and most of my experience is from writing and verifying SAT solvers, but you
don’t have to become an expert at verifying SAT solvers if you don’t want to.</p>

<h2 id="before-starting">Before starting</h2>

<h3 id="verification-can-be-painful">Verification can be painful</h3>

<h3 id="verification-can-be-hard">Verification can be hard</h3>

<h3 id="verification-can-be-fun">Verification can be fun</h3>

<h3 id="verification-can-be-useful">Verification can be useful</h3>

<h2 id="introduction">Introduction</h2>

<h3 id="intro-to-syntax">Intro to syntax</h3>

<h3 id="using-the-syntax">Using the syntax</h3>

<h3 id="a-bigger-example">A bigger example</h3>

<h2 id="some-tips">Some tips</h2>

<h3 id="be-nice-to-the-smt-solvers">Be nice to the SMT solvers</h3>

<h3 id="good-software-practice-is-great-creusot-practice">Good software practice is great Creusot practice</h3>

<p>Creusot charges a much higher interest rate on technical debt and poor choices
than what one may be used to. This means that either you will have to apply
all the stuff you have heard about software best practices, or you will endure a
world of pain. The reason this happens is two-fold: the first is that a program
which was 200 lines, may become 1000 lines when adding proof code. This means that you have the
functionality of 200 lines, but the cognitive burden of 1000. The second reason
is that poorly structured code gives poorly structured proofs, which are even
more impossible to make into well structured proofs than it is to make your code
into well structured code.</p>

<p>Keep in mind: <br />
Creusot increases the magnitude of your “quality of code”-vector.</p>

<h4 id="encapsulation">Encapsulation</h4>

<p>I didn’t write Java for very long, but the little I had to do, made me develop a
disdain for excessive encapsulation. I later got into C, and, as all good C
programmers do, I encapsulated as little as possible. That stuff
may cost CPU cycles, and CPU cycles are what it is all about.</p>

<p>When writing programs to be verified with Creusot: <br />
<strong>do use encapsulation</strong>.</p>

<p>The reason for this is tied to a few things:</p>
<ul>
  <li>As mentioned before, your project will become many times the size of its functionality.
  A change in how something is represented one place in your code may lead to
  the changing of 10 proofs. Proofs are at least as fragile as regular code,
  you don’t want to open for the possibility of you messing them up.</li>
  <li>SMT-solvers like patterns. Your underlying datastructures often exhibit less
  patterns than their abstraction. Remember the mantra: <strong>Be nice to
  your SMT-solvers</strong>.
    <ul>
      <li>An addendum to the point above: Sometimes one encapsulates things, and the
proof stops checking out. This is usually due to the SMT solvers not
“peeking” into your encapsulated data structure, and thus not seeing the
structure which made the proof pass before. A tempting solution is to undo
the encapsulation, as, after all, things were checking out before. I
recommend avoiding this temptation, as this is usually indicative of your
data structures at some later point becoming too convoluted for the SMT
solvers to reason about. In other words: do this only if you are short on
time and 100% sure your data structure will not change, nor be used in any
other proof. A better solution is to annotate your new encapsulations with
their bodies (yes, this is not ideal, but it is better than no encapsulation),
or to redo parts of the proof. I am fairly certain you will see that the
proof checks out faster than before, and that your new abstractions will
make you and your SMT solvers happy in the time to come.</li>
    </ul>
  </li>
  <li>When writing a proof, you are not just figuring out the best representation
  for whatever metrics you like your code to have (speed, usability,
  maintainability of the code etc.), but also the best representation to make
  the proofs easy to do for you, as well as easy to do for the SMT solvers (<strong>Be
  nice to your SMT-solvers</strong>). If you want to stay nimble, properly encapsulate
  your stuff.</li>
</ul>

<h4 id="low-coupling">Low coupling</h4>

<p>This is one of those things which everybody would like to have for all their
code (“Ah I really want my code to be modular and maintainable”), but which is
somewhat hard to achieve in practice (or rather, it is easy to not achieve it.
The hard thing is refraining from the poor choices which lead to high coupling,
and also to think before we write our code.). I am not sure if there exists a
concept similar to Kolmogorov complexity, but for how connected information
is (I’m sure there does), but we want to stay as close to that as possible. The
good thing is that the Rust type system nudges us in the right direction (we
can’t do all the crazy stuff we can do in C/C++), and we only have extend that a
little bit further.</p>

<p>The reason for this is simple:</p>
<ul>
  <li>One large proof is infinitesimally harder than many small. Okay, maybe not
  entirely, but the “hardness” of proofs does not scale linearily. Many
  smaller proofs is much better than one large. This point ties together with
  the “Properties” subchapter of the next chapter.</li>
</ul>

<h3 id="optimize-for-proof-ergonomics-not-code-ergonomics">Optimize for proof ergonomics, not code ergonomics</h3>

<p>Very often, code which is easy to prove is code which is easy to reason about,
and vice versa. Sometimes this is not the case, and you <strong>should always favor
writing code which is easy to prove over code which is easy to write</strong>. The
situation I have faced, and I believe many will face (as it is useful fairly
often), is to have vectors which are padded. This is useful when a somewhat
frequent operation on your vector is to compare an element with its neighbor.</p>

<p>The problem with doing this is that you have traded away ergonomics in the proof
for ergonomics in the code. Suddenly all the functions which operate on your
vector has to require (and ensure) that the vector is padded. It would have been
much better to write a little bit more code in the function where having padding
would be nice, than to introduce this pervasive contract.</p>

<p>(could mention something here about how one could make it into the type or make
transformer functions and that making fragile functions is bad anyways?)</p>

<h2 id="filthy-rewrites">Filthy rewrites</h2>

<h3 id="you-have-to-rewrite">You have to rewrite</h3>

<h3 id="the-hierarchy-of-provenness">The hierarchy of “provenness”</h3>

<p>There is what one may call a “hierarchy for “provenness”” which it is
surprisingly easy to get wrong. The reason one so often gets this wrong, is the
mistaken belief that the highest rung is to statically guarantee runtime safety
and full correctness, with termination. Of course this is nice and all, but the
highest rungs are reserved for programs which are <em>useful</em>. Said bluntly: I
would rather have a program which typechecks and runs fast, than one which has
all the correctness and safety-guarantees, but runs slow.</p>

<p>How much are you willing to pay to guarantee termination? Are you willing to
incur one runtime check to gain 2x speedup?</p>

<p>As a practical example, consider CreuSAT, my SAT solver. For a long time, I did
not want to do runtime checks, and I did definitely not want to make it
explicitly ternary, meaning that I did not want it to have have the possibility of returning some
error-value. Then, at some point, I realized that I could save many hundreds
of lines of proof by doing one runtime check in the case the formula was SAT. Is the performance going to be affected
by one linear pass? No. Did it allow me to move on and prove
more important things which did result in a noticeable speedup? Yes.</p>

<p>Later on I realized that I could save myself a significant amount of time by
allowing my solver to return <code class="language-plaintext highlighter-rouge">Err</code> and not proving correctness for certain
parts. I knew the <code class="language-plaintext highlighter-rouge">Err</code> state would never be reached, but I also knew that
proving so would take a significant amount of time. What do users of SAT solvers
care about? Speed. All solvers have an either implicit or explicit error state,
which is that the solver times out. Most people would take the theoretical
possibility of recieving an explicit error, if it gave them a solver which is X
times faster.</p>

<p>In short:</p>
<ul>
  <li>Think about what the important metrics for your application is, and the various tradeoffs you can do in terms of what you prove to achieve those metrics.</li>
</ul>

<p>The hierarchy, more or less. Sure, there may be cases where proving termination is more important than even correctness or safety:</p>
<ol>
  <li>Useful and statically proven safety, correctness, completeness, and termination</li>
  <li>Useful and statically proven safety, correctness, and either completeness or termination</li>
  <li>Useful and statically proven safety and correctness</li>
  <li>Useful with runtime checks and statically proven correctness and termination</li>
  <li>Useful with runtime checks and statically proven correctness</li>
  <li>Useful with type safety</li>
  <li>Useless. Who cares what you have proven, your program is useless</li>
</ol>

<h2 id="more-advanced-topics">More advanced topics</h2>

<h3 id="lemma-functions">Lemma functions</h3>

<h4 id="pro-tip-lemmas-as-tests">Pro tip: Lemmas as tests</h4>

<h3 id="reaching-up-to-why3">“Reaching up” to Why3</h3>

<h3 id="thinking-in-terms-of-properties">Thinking in terms of properties</h3>

<h2 id="some-more-advanced-tips">Some more advanced tips</h2>

<h3 id="repeat-the-tip-from-earlier">(Repeat the tip from earlier)</h3>

<h3 id="split-borrows">Split borrows</h3>

<h2 id="some-practical-tips-and-tricks-for-using-creusot">Some practical tips and tricks for using Creusot</h2>

<h3 id="pass-through">Pass-through</h3>

<h3 id="using-cargo-make-or-aliasing-mlcfg-and-why3-ide">Using cargo make (or aliasing mlcfg and why3-ide)</h3>

<h3 id="using-cfgcontracts-and-trusted">Using cfg(contracts) and #[trusted]</h3>


        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#creusot" class="page__taxonomy-item p-category" rel="tag">Creusot</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-06-13T21:34:30+02:00">June 13, 2022</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Some+tips+on+doing+program+proofs+in+Creusot%20http%3A%2F%2Flocalhost%3A4000%2Fcreusot%2Fcreusot%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fcreusot%2Fcreusot%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fcreusot%2Fcreusot%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You May Also Enjoy</h2>
      <div class="grid__wrapper">
        
          
            
      </div>
    </div>
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 . Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
